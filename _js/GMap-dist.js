"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function o(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}}(),GMap=function(){function o(e,t,a){_classCallCheck(this,o),this.setDestination=a.setDestination,this.lojas=e,this.ofertas=t,this.marcadores={},this.INITIAL_CENTER=new google.maps.LatLng(-12.924874197441222,-52.589341558882325),this.CITY_ZOOM=11,this.INITIAL_ZOOM=5,this.MARKER_ZOOM=18,this.OFFSETX=175,this.INFOWINDOW_WIDTH=300,this.STORE_FOUND=!1,this.SEARCH_NEAREST_AFTER=!1,this.iniciaMapa(),this.buscaEnderecoCallback=this.buscaEnderecoCallback.bind(this)}return _createClass(o,[{key:"iniciaMapa",value:function(){var e=this;this.map=new google.maps.Map(document.querySelector("#map"),{center:this.INITIAL_CENTER,mapTypeControl:!1,styles:[{featureType:"all",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"poi.attraction",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.business",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.school",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"all",stylers:[{visibility:"off"}]}],zoom:this.INITIAL_ZOOM}),setTimeout(function(){480<$(window).width()?e.centralizaOffset(e.INITIAL_CENTER):e.map.setCenter(e.INITIAL_CENTER)},1e3),this.geocoder=new google.maps.Geocoder,this.lojas.length&&(this.adicionaMarcadores(),this.adicionaInfoWindow())}},{key:"adicionaMarcadores",value:function(){var t=this;this.lojas.map(function(e){return t.adicionaMarcador(e)})}},{key:"adicionaMarcador",value:function(e){var t=parseFloat(e.lat),a=parseFloat(e.lng),o=e.id;this.marcadores.hasOwnProperty(e.id)&&(t+=2e-5,a+=2e-5,o=e.id+"_"+e.tipo);var i=new google.maps.Marker({id:o,tipo:e.tipo,animation:google.maps.Animation.DROP,map:this.map,title:e.loja,position:{lat:t,lng:a},icon:this.iconeMarcadorPorTipo(e.tipo)});i.addListener("click",this.criaCallbackMarcador(e,i)),this.marcadores[o]=i}},{key:"criaCallbackMarcador",value:function(e,t){var a=this;return function(){a.infoWindow.setContent(a.conteudoInfoWindow(e)),a.infoWindow.setOptions({maxWidth:a.INFOWINDOW_WIDTH}),a.infoWindow.open(a.map,t),a.map.setZoom(a.MARKER_ZOOM),480<$(window).width()?a.map.setCenter(a.centralizaOffset(t.getPosition())):a.map.setCenter(t.getPosition()),a.alternaAnimacao(t),a.setDestination(e)}}},{key:"disparaCliqueMarcador",value:function(e){this.marcadores[e]&&(new google.maps.event.trigger(this.marcadores[e],"click"),$(window).width()<480&&$("html, body").animate({scrollTop:$("#map").offset().top},500))}},{key:"buscaEndereco",value:function(e){this.geocoder.geocode({address:e},this.buscaEnderecoCallback)}},{key:"buscaMaisProximo",value:function(e){var t=null,a=null;for(var o in this.STORE_FOUND=!1,this.marcadores){var i=this.marcadores[o],n=new google.maps.LatLng(i.getPosition().lat(),i.getPosition().lng()),s=google.maps.geometry.spherical.computeDistanceBetween(e,n);isNaN(s)||(null===a||s<t)&&(t=s,a=i)}Math.ceil(t/1e3)<600?(this.disparaCliqueMarcador(a.id),this.STORE_FOUND=!0):alert("Sentimos muito. Nenhuma loja foi encontrada no radio de 600km de sua busca.")}},{key:"buscaEnderecoCallback",value:function(e){if(!e[0])return alert("Não foi possível pesquisar este local."),!1;var t=e[0].geometry.location.lat(),a=e[0].geometry.location.lng();-1<e[0].types.indexOf("locality")?this.map.setZoom(this.CITY_ZOOM):(-1<e[0].types.indexOf("street_address")||-1<e[0].types.indexOf("postal_code"))&&this.map.setZoom(this.MARKER_ZOOM),480<$(window).width()?(this.centralizaOffset(new google.maps.LatLng(t,a)),$("html, body").animate({scrollTop:$("#map").offset().top},500)):this.map.setCenter(new google.maps.LatLng(t,a)),this.SEARCH_NEAREST_AFTER&&(setTimeout(function(){return window.gmap.buscaMaisProximo(new google.maps.LatLng(t,a))},100),this.SEARCH_NEAREST_AFTER=!1)}},{key:"iconeMarcadorPorTipo",value:function(e){switch(e){case"express":return"https://static.carrefour.com.br/imagens/localizador/_img/pin_express.png";case"market":case"bairro":return"https://static.carrefour.com.br/imagens/localizador/_img/pin_market.png";case"drogaria":return"https://static.carrefour.com.br/imagens/localizador/_img/pin_drogaria.png";case"posto":return"https://static.carrefour.com.br/imagens/localizador/_img/pin_posto.png";default:return"https://static.carrefour.com.br/imagens/localizador/_img/pin_hiper.png"}}},{key:"alternaAnimacao",value:function(e){this.currentBoucing&&(e.setZIndex(9),this.currentBoucing.setAnimation(null)),e.setZIndex(99),e.setAnimation(google.maps.Animation.BOUNCE),this.currentBoucing=e}},{key:"adicionaInfoWindow",value:function(){this.infoWindow=new google.maps.InfoWindow}},{key:"centralizaOffset",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.OFFSETX,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=this.map.getZoom(),i=Math.pow(2,o),n=this.map.getProjection().fromLatLngToPoint(e),s=new google.maps.Point(t/i||0,a/i||0),r=new google.maps.Point(n.x-s.x,n.y+s.y),l=this.map.getProjection().fromPointToLatLng(r);this.map.setCenter(l),this.map.setZoom(o)}},{key:"conteudoInfoWindow",value:function(e){return'\n\t\t\t<h3 class="info-window__title">'+e.loja+'</h3>\n\t\t\t<p class="info-window__text">\n\t\t\t\t'+e.logradouro+", "+e.numero+(e.complemento?" - "+e.complemento:"")+"\n\t\t\t</p>\n\t\t"}},{key:"filtraMarcadores",value:function(e){for(var t in this.marcadores){var a=this.marcadores[t];a.setVisible(!(0<=e.indexOf(a.tipo)))}}},{key:"escondeTodosMarcadores",value:function(){for(var e in this.marcadores){this.marcadores[e].setVisible(!1)}}},{key:"mostraTodosMarcadores",value:function(){for(var e in this.marcadores){this.marcadores[e].setVisible(!0)}}},{key:"getLojaById",value:function(t,e){return this.lojas.filter(function(e){return t===e.id})}}]),o}();